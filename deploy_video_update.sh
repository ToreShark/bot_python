#!/bin/bash
# ะกะบัะธะฟั ะดะปั ะฑััััะพะณะพ ัะฐะทะฒะตัััะฒะฐะฝะธั ะพะฑะฝะพะฒะปะตะฝะธั ะฒะธะดะตะพะบะฐะฝะฐะปะฐ

echo "๐ ะะะะะะะขะซะะะะะ ะะะะะะะะะะฏ ะะะะะะะะะะะ"
echo "========================================"

# ะัะพะฒะตัะบะฐ, ััะพ ะผั ะฝะฐ ะฟัะฐะฒะธะปัะฝะพะผ ัะตัะฒะตัะต
read -p "โ๏ธ  ะญัะพ ะฟัะพะดะฐะบัะฝ ัะตัะฒะตั? (yes/no): " confirm
if [ "$confirm" != "yes" ]; then
    echo "โ ะะฐะทะฒะตัััะฒะฐะฝะธะต ะพัะผะตะฝะตะฝะพ"
    exit 1
fi

echo "๐ฅ 1. ะะฑะฝะพะฒะปัะตะผ ะบะพะด..."
git pull origin main || git fetch && git merge

echo "๐ 2. ะัะพะฒะตััะตะผ ัะตะบััะตะต ัะพััะพัะฝะธะต..."
python quick_prod_check.py
if [ $? -eq 0 ]; then
    echo "โ ะกะธััะตะผะฐ ัะถะต ะพะฑะฝะพะฒะปะตะฝะฐ!"
    exit 0
fi

echo "๐ 3. ะะฑะฝะพะฒะปัะตะผ ะฑะฐะทั ะดะฐะฝะฝัั..."
python seed_video_production.py

echo "๐ 4. ะะตัะตะทะฐะฟััะบะฐะตะผ ะฑะพัะฐ..."
pkill -f "python main.py"
sleep 2
nohup python main.py > bot.log 2>&1 &
echo "โ ะะพั ะฟะตัะตะทะฐะฟััะตะฝ (PID: $!)"

echo "๐ 5. ะคะธะฝะฐะปัะฝะฐั ะฟัะพะฒะตัะบะฐ..."
sleep 3
python quick_prod_check.py

if [ $? -eq 0 ]; then
    echo "๐ ะะะะะะะขะซะะะะะ ะฃะกะะะจะะ ะะะะะะจะะะ!"
else
    echo "โ๏ธ  ะะฐะทะฒะตัััะฒะฐะฝะธะต ะทะฐะฒะตััะตะฝะพ ั ะฟัะตะดัะฟัะตะถะดะตะฝะธัะผะธ"
    echo "๐ ะกะผะพััะธัะต ะธะฝััััะบัะธะธ ะฒ PRODUCTION_DEPLOY.md"
fi